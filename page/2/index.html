<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="what&apos;s past is prologue">
<meta name="keywords" content="keywords_eg">
<meta property="og:type" content="website">
<meta property="og:title" content="renz">
<meta property="og:url" content="https://renzheng0403.github.io/page/2/index.html">
<meta property="og:site_name" content="renz">
<meta property="og:description" content="what&apos;s past is prologue">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="renz">
<meta name="twitter:description" content="what&apos;s past is prologue">






  <link rel="canonical" href="https://renzheng0403.github.io/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>renz</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">renz</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">what's past is prologue</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://renzheng0403.github.io/2017/09/07/2017-09-07-markdown-flow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="renzheng">
      <meta itemprop="description" content="what's past is prologue">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="renz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/07/2017-09-07-markdown-flow/" itemprop="url">
                  markdown flow
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-09-07 00:00:00" itemprop="dateCreated datePublished" datetime="2017-09-07T00:00:00+08:00">2017-09-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-19 09:20:07" itemprop="dateModified" datetime="2018-05-19T09:20:07+08:00">2018-05-19</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-flowchart"><a href="#1-flowchart" class="headerlink" title="1 flowchart"></a>1 flowchart</h1><p>流程图语法分为两部分：</p>
<ul>
<li>定义流程图元素</li>
<li>定义流程图的执行走向（用来连接流程图元素）</li>
</ul>
<h2 id="1-1-定义元素"><a href="#1-1-定义元素" class="headerlink" title="1.1 定义元素"></a>1.1 定义元素</h2><figure class="highlight clojure-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">tag=&gt;</span><span class="clojure">type: content</span></span><br></pre></td></tr></table></figure>
<h3 id="1-1-1-说明"><a href="#1-1-1-说明" class="headerlink" title="1.1.1 说明"></a>1.1.1 说明</h3><ul>
<li><strong>tag</strong>流程图的标签，用来在定义执行走向的时候指定下一步到达何处，可理解为<strong>名字</strong></li>
<li><strong>type</strong>确定标签类型，表示这个标签的种类是开始结束，输入输出还是判断等</li>
<li><strong>content</strong>流程图文本框内的描述内容</li>
</ul>
<h3 id="1-1-2-标签类型"><a href="#1-1-2-标签类型" class="headerlink" title="1.1.2 标签类型"></a>1.1.2 标签类型</h3><ul>
<li><code>start</code>：开始<code>st=&gt;start: 开始</code></li>
<li><code>end</code>：结束<code>e=&gt;end: 结束</code></li>
<li><code>operation</code>：操作、步骤、执行说明<code>op1=&gt;operation: come to eat</code></li>
<li><code>subroutine</code>：子步骤<code>sb1=&gt;subroutine: go back</code></li>
<li><code>condition</code>：条件选择<code>cond=&gt;condition: is it rain?</code></li>
<li><code>inputoutput</code>：输入输出</li>
</ul>
<h2 id="1-2-定义执行走向"><a href="#1-2-定义执行走向" class="headerlink" title="1.2 定义执行走向"></a>1.2 定义执行走向</h2><ul>
<li>使用<code>-&gt;</code>连接两个元素(标签)</li>
<li>对于<code>condition</code>类型，有<code>cond(yes)</code>和<code>cond(no)</code>两种控制走向的语法</li>
<li>其他元素也可以控制分支方向，默认<code>向下</code>，使用<code>right</code>向右，例<code>sb1(right)</code></li>
</ul>
<h2 id="1-3-实例"><a href="#1-3-实例" class="headerlink" title="1.3 实例"></a>1.3 实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: Home</span><br><span class="line">e=&gt;end: Restaurant</span><br><span class="line">op1=&gt;operation: get out to eat</span><br><span class="line">cond=&gt;condition: is it rain?</span><br><span class="line">sb1=&gt;subroutine: go back and try again</span><br><span class="line">op2=&gt;operation: arrive</span><br><span class="line">st-&gt;op1-&gt;cond</span><br><span class="line">cond(yes)-&gt;op2-&gt;e</span><br><span class="line">cond(no)-&gt;sb1(right)-&gt;op1</span><br></pre></td></tr></table></figure>
<p><img src="/images/example-flowchart.png" alt="flowchart"></p>
<h1 id="2-sequence"><a href="#2-sequence" class="headerlink" title="2 sequence"></a>2 sequence</h1><p>sequence语法仅一种格式，即A到B的路径，外加可控制的note</p>
<h2 id="2-1-定义元素"><a href="#2-1-定义元素" class="headerlink" title="2.1 定义元素"></a>2.1 定义元素</h2><p><img src="/images/sequence-grammar.png" alt="sequence grammar"></p>
<h3 id="2-1-1-说明"><a href="#2-1-1-说明" class="headerlink" title="2.1.1 说明"></a>2.1.1 说明</h3><ul>
<li>路径：包含两种线型和两种箭头，共四种组合方式</li>
<li><strong>note</strong>：旁注</li>
</ul>
<h2 id="2-2-实例"><a href="#2-2-实例" class="headerlink" title="2.2 实例"></a>2.2 实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Title: Here is a title</span><br><span class="line">A-&gt;B: Normal line</span><br><span class="line">B--&gt;C: Dashed line</span><br><span class="line">C-&gt;&gt;D: Open arrow</span><br><span class="line">D--&gt;&gt;A: Dashed open arrow</span><br><span class="line">Note left of A: Note to the\n left of A</span><br><span class="line">Note right of A: Note to the\n right of A</span><br><span class="line">Note over A: Note over A</span><br><span class="line">Note over A,B: Note over both A and B</span><br></pre></td></tr></table></figure>
<p><img src="/images/example-sequence.PNG" alt="js sequence diagrams"></p>
<h2 id="2-3-参考"><a href="#2-3-参考" class="headerlink" title="2.3 参考"></a>2.3 参考</h2><p><a href="https://bramp.github.io/js-sequence-diagrams/" target="_blank" rel="noopener">js-sequence-diagrams/Turns text into UML sequence diagrams</a></p>
<h1 id="附"><a href="#附" class="headerlink" title="附"></a>附</h1><p>未完待续，后面还会介绍mathjax用法，这个在这个模板里直接就可以使用，而以上两个属性暂时还不支持，应该是和js调用有关，太麻烦，我只是想使用，便于展示总结，所以暂时使用截图</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://renzheng0403.github.io/2017/08/26/2017-08-26-PKI知识点总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="renzheng">
      <meta itemprop="description" content="what's past is prologue">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="renz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/26/2017-08-26-PKI知识点总结/" itemprop="url">
                  网关服务端第一阶段总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-08-26 00:00:00" itemprop="dateCreated datePublished" datetime="2017-08-26T00:00:00+08:00">2017-08-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-06-24 20:30:23" itemprop="dateModified" datetime="2018-06-24T20:30:23+08:00">2018-06-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI/" itemprop="url" rel="index"><span itemprop="name">PKI</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-算法"><a href="#1-算法" class="headerlink" title="1 算法"></a>1 算法</h1><h2 id="1-1-对称算法"><a href="#1-1-对称算法" class="headerlink" title="1.1 对称算法"></a>1.1 对称算法</h2><p>描述：对称加密是指加密过程和解密过程使用相同的密码。主要分：<strong>分组加密</strong>、<strong>序列加密</strong>。</p>
<p>原理：XOR运算，将二进制数据进行XOR运算，两次同样的操作得到原文，所以大致过程就是加密-&gt;A xor B = C，解密-&gt;C xor B = A（B就是密钥）。</p>
<p>优点：加密速度快，适合于对大量数据加密。</p>
<p>缺点：发送方和接受方需要使用相同的密钥，一旦密钥泄露，在互联网上传输的加密数据将会被中间人破解。而且由于加密数据量大</p>
<p>分类：</p>
<ul>
<li>DES(Data Encryption Standard)<ul>
<li>分组算法</li>
<li>分组长度64bit（8字节），明文分为左右两侧轮回与密钥XOR运算，每轮使用不同的密钥</li>
<li>密钥空间2^56</li>
</ul>
</li>
<li>三重DES(triple-DES),将DES重复3次<ul>
<li>分组长度64bit（8字节）</li>
</ul>
</li>
<li>AES(Advances Encryption Standard)，高级加密标准<ul>
<li>分组长度为128bit（16字节）</li>
<li>密钥长度只有128、192、256bit</li>
</ul>
</li>
<li>RC2,RC4,RC5<ul>
<li>RC2和RC5是分组算法，RC4是序列算法</li>
<li>RC5分组可变、密钥长度可变</li>
</ul>
</li>
<li>SSF33,SM1,SM4<ul>
<li>分组算法</li>
<li>分组长度128bit（16字节）</li>
</ul>
</li>
</ul>
<h2 id="1-2-摘要算法"><a href="#1-2-摘要算法" class="headerlink" title="1.2 摘要算法"></a>1.2 摘要算法</h2><p>摘要算法使用密码学hash函数，用于验证数据完整性（没有修改、插入、删除、或重放）。</p>
<p>输入数据的长度首先被填充为某固定长度分组的整数倍，填充的内容包括原始数据的位长度信息。安全性要求如下两种情况在计算上不可行（即没有攻击方法比穷举攻击更有效）：</p>
<ul>
<li>对预先指定的hash值找到对应的数据块（单向性）</li>
<li>找到两个不同的数据块对应相同的hash值（抗碰撞性）</li>
</ul>
<p>例如：Alice给Bob发了一条消息，Bob收到消息后，1）不能确定是不是Alice发的；2）不能确定消息是否被篡改。单向hash函数仍然不能解决问题1），但是可以解决问题2）。假如Bob能够从某种渠道获取这条消息的摘要值，那么只需在对收到的信息进行相同的hash计算，将结果与摘要值对比，若不同就说明消息遭到了篡改。</p>
<p>Hash算法一般是指Hash表的摘要算法，将不同的键值分散到不同的数组位置，允许少量的冲突碰撞</p>
<p>安全Hash算法（SHA）是使用最广泛的Hash函数</p>
<ul>
<li>MD2、MD4、MD5<ul>
<li>摘要长度128bit（16字节）</li>
</ul>
</li>
<li>SHA1、SHA2、SHA3<ul>
<li>Secure Hash Algorithm</li>
<li>SHA-1摘要长度160bit（20字节）</li>
<li>SHA-2摘要长度256bit（32byte)</li>
<li>SHA-3摘要长度384bit（48byte)</li>
</ul>
</li>
<li>SM3<ul>
<li>中国国家商用密码算法</li>
<li>摘要长度256bit（32byte）</li>
</ul>
</li>
</ul>
<p><a href="http://www.cnblogs.com/houkai/p/3486667.html" target="_blank" rel="noopener">摘要函数——MD2/MD4/MD5数字签名</a></p>
<h2 id="附1：消息认证码（MAC-Message-authentication-code）"><a href="#附1：消息认证码（MAC-Message-authentication-code）" class="headerlink" title="附1：消息认证码（MAC, Message authentication code）"></a>附1：消息认证码（MAC, Message authentication code）</h2><p>上节提到的摘要函数-单向散列函数只能识别消息是否完整，不能识别发送者的身份，消息认证码使用一种密钥相关联的单向散列函数，输入包括消息、密钥（发送者和接受者共享），输出固定长度的MAC值。</p>
<p>又称密码校验和，利用密钥<strong>K</strong>和可变长度的数据<strong>M</strong>生成固定长度的短数据块<strong>MAC</strong>，并将数据块附加在数据M之后：<br>$$<br>MAC = C(K, M)<br>$$<br>若对于数据的保密性要求不高（例如广播），可直接将消息<strong>M</strong>和<strong>MAC</strong>一起发给接受者，接收者收到后使用相同的密钥<strong>K</strong>和MAC函数<strong>C</strong>对消息<strong>M</strong>计算得出<strong>MAC2</strong>，再对比两者是否相等。（这里设定通信双方共享相同的密钥<strong>K</strong>）</p>
<p>若对于数据的保密性要求严格，可选择将消息<strong>M</strong>和<strong>MAC</strong>加密再发送：<br>$$<br>ENC = E(K_2, M||C(K_1,M))<br>$$<br>接收者收到数据后首先解密。</p>
<h2 id="附2：基于Hash函数的MAC：HMAC"><a href="#附2：基于Hash函数的MAC：HMAC" class="headerlink" title="附2：基于Hash函数的MAC：HMAC"></a>附2：基于Hash函数的MAC：HMAC</h2><p>HMAC将Hash函数视为黑盒，将现有Hash函数作为一个模块，预先封装，在需要时直接使用。</p>
<p><img src="/images/HMAC.JPG" alt="HMAC结构"></p>
<ul>
<li>H：嵌入的Hash函数</li>
<li>IV：Hash函数输入的初始化数组</li>
<li>M：HMAC的消息输入（包括由嵌入Hash函数定义的填充位）</li>
<li>$Y_i$：M的第i个分组</li>
<li>L：M中的分组个数</li>
<li>b：每一分组所含位数（bits）</li>
<li>n：嵌入的Hash函数所产生的Hash码长<h2 id="1-3-密钥运算"><a href="#1-3-密钥运算" class="headerlink" title="1.3 密钥运算"></a>1.3 密钥运算</h2>密钥运算包含两种操作（私钥操作、公钥操作），签名验签正是基于这两种操作：<br>$$<br>C=P^d mod n<br>$$</li>
</ul>
<p>$$<br>P=C^d mod n<br>$$</p>
<h3 id="1-3-1-签名验签"><a href="#1-3-1-签名验签" class="headerlink" title="1.3.1 签名验签"></a>1.3.1 签名验签</h3><p>使用签名的前提是使用公钥加密的密文只有私钥才能解开，使用私钥加密的密文只有公钥才能解开，确保了身份认证抗抵赖性。</p>
<p>过程：</p>
<ul>
<li>对原文摘要</li>
<li>A使用自己的私钥AS对摘要私钥加密运算，得到签名</li>
<li>B使用A的公钥AP对签名公钥解密运算，得到摘要值2，这一步证明签名来自A，若C伪造A的身份使用自己的私钥CP，则B的公钥解密失败。</li>
<li>B再使用和A相同的hash算法对原文摘要，得到摘要值3，这一步可用来验证原文是否遭到篡改，</li>
<li>B验证摘要值2和3是否相等</li>
</ul>
<p>至于填充模式，定义在PKCS#1：<code>00||BT||PS||00||D</code></p>
<ul>
<li>00保证大数是非负整数</li>
<li>BT分为00，01，02。00,01是私钥操作，02是公钥操作<ul>
<li>00：填充数据全为0X00，摘要必须以非0开头，如果摘要以0开头，将与填充数据无法区分</li>
<li>01：填充数据全为0XFF</li>
<li>02：填充数据必须为随机数</li>
</ul>
</li>
</ul>
<h3 id="1-3-2-非对称算法"><a href="#1-3-2-非对称算法" class="headerlink" title="1.3.2 非对称算法"></a>1.3.2 非对称算法</h3><p>非对称算法采用一对关联的公钥和私钥，公钥公开在互联网，解决了密钥配送的问题。</p>
<p>非对称算法用来在公开的网络上传输密钥依据以下<strong>两个特点</strong>：</p>
<ol>
<li>使用公钥加密的密文只有使用对应的私钥才能解开</li>
<li>使用私钥解密的密文只有使用对应的公钥才能解开</li>
</ol>
<p>分类：</p>
<ul>
<li>ECC算法（Elliptic Curve Cryptosystems, 椭圆曲线密码)</li>
<li>RSA算法</li>
</ul>
<p><strong>RSA</strong><br>使用RSA公钥运算，过程如下：</p>
<ul>
<li>对原文数据填充、封装-&gt;$P$</li>
<li>对P大数运算：$C=P^e mod n$</li>
</ul>
<p>使用RSA私钥运算，过程如下：</p>
<ul>
<li>对密文数据大数运算：$P=C^d mod n$</li>
<li>对P进行去填充</li>
</ul>
<p>以上可以看出，私钥解密和签名的运算过程一致！</p>
<p>用途：用于非对称传输信息，比如Bob有一个信息想传给Alice，需使用Alice的公钥加密信息，传给Alice，Alice得到加密信息后使用自己的私钥即可解开读取信息。他人即使截获加密信息也无法解开。</p>
<h3 id="1-3-3-国密算法"><a href="#1-3-3-国密算法" class="headerlink" title="1.3.3 国密算法"></a>1.3.3 国密算法</h3><p>SM2：椭圆曲线公钥密码算法<br>SM3：密码杂凑算法，用于数字签名和验证、消息认证码的生成、随机数的生成<br>SM4：分组加密算法，分组长度128bit，密钥长度128bi。32轮非平衡Feistel迭代结构，之后加上一个反序变换。</p>
<h1 id="2-规范"><a href="#2-规范" class="headerlink" title="2 规范"></a>2 规范</h1><h2 id="2-1-分组模式"><a href="#2-1-分组模式" class="headerlink" title="2.1 分组模式"></a>2.1 分组模式</h2><ul>
<li>ECB （Electronic Code book，电子密码本方式）明文分组与密文分组一一对应<ul>
<li>优点：最简单的一种模式，可并行运算，误差不会传递</li>
<li>缺点：若有相同明文分组，将被加密成相同密文分组，即明文的结构容易被泄露</li>
<li>CA产品的私钥保护使用ECB算法</li>
</ul>
</li>
<li>CBC （Cipher-block chaining，密码分组链接）明文分组首先与前一个密文分组XOR运算，然后再加密，这样做的目的就是改变明文分组的结构，由于第一个明文分组前没有密文分组，需增添IV初始化向量，与第一个明文分组XOR运算<ul>
<li>若密文分组损坏，但是长度没有改变，即仅改变几位的数据，解密后最多只影响两个明文分组（密文分组本身对应的明文分组，密文分组为后一个分组提供XOR伙伴的后一个明文分组）</li>
<li>若密文缺失bit，则缺失bit之后的密文全部无法解密</li>
</ul>
</li>
<li>CFB （Cipher Feedback ，密码反馈模式）明文分组与密钥XOR运算，CFB实现了一个被我称为伪伪随机数发生器的密码算法，它将前一个密文分组加密生成一个bit序列，称为密钥流（key stream），由于第一个明文分组前没有密文分组，需添加IV初始化向量，执行加密生成第一个密钥流。</li>
<li>OFB （Output Feedback  ，输出反馈模式）OFB与CFB相同的地方在于都是将明文分组与密钥XOR运算，区别就在于密钥的生成。OFB的密钥算法的输入来自于上一个密钥算法的输出。第一个密钥算法的输入使用一个IV向量</li>
</ul>
<p>OFB与CFB都采用将分组加密转换成流加密的方式</p>
<h2 id="2-2-填充模式"><a href="#2-2-填充模式" class="headerlink" title="2.2 填充模式"></a>2.2 填充模式</h2><ul>
<li>PKCS5Padding<br><img src="/images/PKCS5Padding.png" alt="PKCS5Padding"><br>如图，用自己的话来描述就是缺多少bit，就在每个bit里填多少。该方式是8分组结构，只适合DES/3DES。</li>
<li>PKCS7Padding<br>分组长度可以是小于255的任意长度</li>
<li>ZeroPadding<br>使用0X0补齐：<code>... | DD DD DD DD DD DD DD DD | DD DD DD DD 00 00 00 00 |</code></li>
<li>ANSI X.923<br>该模式在最后一个字节填缺少的bit数，其它补0X0（我觉得这个模式更符合一般人的想法）：<code>... | DD DD DD DD DD DD DD DD | DD DD DD DD 00 00 00 04 |</code></li>
<li>ISO 10126<br>该模式个人觉得稍好一些，最后一个填充位填写缺少的bit数，其它位填充随机数：<code>... | DD DD DD DD DD DD DD DD | DD DD DD DD 81 A6 23 04 |</code></li>
<li>ISO/IEC 7816-4<br>填充实例如下：<code>... | DD DD DD DD DD DD DD DD | DD DD DD DD 80 00 00 00 |</code>（未解）</li>
</ul>
<h2 id="2-3-PKCS-1"><a href="#2-3-PKCS-1" class="headerlink" title="2.3 PKCS#1"></a>2.3 PKCS#1</h2><p>定义RSA公私钥数据表达形式，及加密，解密，签名，验签，填充过程，定义了数字签名如何计算，包括签名数据和签名本身的格式。<br><strong>RSA公钥结构：</strong><br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RSAPublicKey :: = <span class="keyword">SEQUENCE</span>&#123;</span><br><span class="line">   modulus              <span class="keyword">INTEGER</span>,   ------ n（RSA合数模）</span><br><span class="line">   publicExponent    <span class="keyword">INTEGER</span>    ------ e （RSA公开幂，<span class="number">3</span>～n-<span class="number">1</span>范围内的正整数）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>RSA公钥的ASN.1结构，可以表述为：名为RSAPublicKey的这个结构呢，就可以用来表述一个RSA公钥了。它有两个INTEGER型变量：modulus和publicExponent。<br><strong>RSA私钥结构：</strong><br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RSAPrivateKey :: = <span class="keyword">SEQUENCE</span>&#123;</span><br><span class="line">    version                 Version,（版本号，如果使用多素数，版本号为<span class="number">1</span>）</span><br><span class="line">    modulus               <span class="keyword">INTEGER</span>,   ------ n（RSA合数模）</span><br><span class="line">    publicExponent     <span class="keyword">INTEGER</span>,   ------ e（RSA的公开幂）</span><br><span class="line">    privateExponent    <span class="keyword">INTEGER</span>,   ------ d（RSA的私有幂）</span><br><span class="line">    prime1                 <span class="keyword">INTEGER</span>,   ------ p（n的素数因子p）</span><br><span class="line">    prime2                 <span class="keyword">INTEGER</span>,   ------ q（n的素数因子q）</span><br><span class="line">    exponent1            <span class="keyword">INTEGER</span>,   ------ d <span class="built_in">mod</span> (p -<span class="number">1</span>)</span><br><span class="line">    exponent2            <span class="keyword">INTEGER</span>,   ------ d <span class="built_in">mod</span> (q -<span class="number">1</span>)</span><br><span class="line">    coefficient            <span class="keyword">INTEGER</span>,   ------- (inverse of q) <span class="built_in">mod</span> p</span><br><span class="line">    otherPrimeInfos    OtherPrimeInfos   ------ <span class="keyword">OPTIONAL</span>（当version为<span class="number">0</span>时，不存在；当 version为<span class="number">1</span>时，必须有）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>加密和签名方案的对象标识</strong><br>以下是对PKCS#1 OID的类型表示的定义<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PKCS1Algorithms ALGORITHM-IDENTIFIER ::= &#123;</span><br><span class="line"> &#123; OID rsaEncryption PARAMETERS <span class="literal">NULL</span> &#125; <span class="string">|</span></span><br><span class="line"> &#123; OID md2WithRSAEncryption PARAMETERS <span class="literal">NULL</span> &#125; <span class="string">|</span></span><br><span class="line"> &#123; OID md5WithRSAEncryption PARAMETERS <span class="literal">NULL</span> &#125; <span class="string">|</span></span><br><span class="line"> &#123; OID sha1WithRSAEncryption PARAMETERS <span class="literal">NULL</span> &#125; <span class="string">|</span></span><br><span class="line"> &#123; OID sha256WithRSAEncryption PARAMETERS <span class="literal">NULL</span> &#125; <span class="string">|</span></span><br><span class="line"> &#123; OID sha384WithRSAEncryption PARAMETERS <span class="literal">NULL</span> &#125; <span class="string">|</span></span><br><span class="line"> &#123; OID sha512WithRSAEncryption PARAMETERS <span class="literal">NULL</span> &#125; <span class="string">|</span></span><br><span class="line">&#123; OID id-RSAES-OAEP PARAMETERS RSAES-OAEP-params &#125; <span class="string">|</span></span><br><span class="line"> PKCS1PSourceAlgorithms <span class="string">|</span></span><br><span class="line">&#123; OID id-RSASSA-PSS PARAMETERS RSASSA-PSS-params &#125; ,</span><br><span class="line"> ... -- Allows for future expansion --</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>规定了PKCS#1摘要和签名分别使用的算法，例如<code>sha1WithRSAEncryption</code>中<code>sha1</code>代表摘要使用的算法，<code>RSAEncryption</code>代表签名使用的算法<br><strong>RSAES-OAEP加密</strong><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RSAES-OAEP-params ::= SEQUENCE &#123;</span><br><span class="line"> hashAlgorithm [0] HashAlgorithm<span class="built_in"> DEFAULT </span>sha1,(标识了散列函数）</span><br><span class="line"> maskGenAlgorithm [1] MaskGenAlgorithm<span class="built_in"> DEFAULT </span>mgf1SHA1, （标识掩膜生成函数）</span><br><span class="line"> pSourceAlgorithm [2] PSourceAlgorithm<span class="built_in"> DEFAULT </span>pSpecifiedEmpty（标识标签L的源)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>hashAlgorithm</code>支持的散列函数：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">OAEP-PSSDigestAlgorithms ALGORITHM-IDENTIFIER ::= &#123;</span><br><span class="line"> &#123; OID <span class="keyword">id</span>-sha1 PARAMETERS <span class="literal">NULL</span> &#125;|</span><br><span class="line">&#123; OID <span class="keyword">id</span>-sha256 PARAMETERS <span class="literal">NULL</span> &#125;|</span><br><span class="line">&#123; OID <span class="keyword">id</span>-sha384 PARAMETERS <span class="literal">NULL</span> &#125;|</span><br><span class="line">&#123; OID <span class="keyword">id</span>-sha512 PARAMETERS <span class="literal">NULL</span> &#125;,</span><br><span class="line"> ... -- Allows <span class="keyword">for</span> future expansion --</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-4-PKCS-5"><a href="#2-4-PKCS-5" class="headerlink" title="2.4 PKCS#5"></a>2.4 PKCS#5</h2><p>基于口令的加密规范Password-Based Cryptography Specification</p>
<p>目的：保护私钥文件的安全性</p>
<p>通过将原始口令+salt派生出新口令进行加密</p>
<p>PKSC5Padding（用于制定算法DES）对称加密填充方式，填充块固定为8个字节，填充值为待填充的长度，与PKCS7Padding类似。</p>
<h2 id="2-5-PKCS-7"><a href="#2-5-PKCS-7" class="headerlink" title="2.5 PKCS#7"></a>2.5 PKCS#7</h2><p>加密消息的语法标准Cryptographic Message Syntax Version 1.5<br>结构：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">pkcs7_st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="comment">/* 其他项 */</span></span><br><span class="line"></span><br><span class="line">  ASN1_OBJECT *type;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">union</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">char</span> *ptr;</span><br><span class="line">   <span class="comment">/* NID_pkcs7_data */</span></span><br><span class="line">   ASN1_OCTET_STRING *data;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* NID_pkcs7_signed */</span></span><br><span class="line">   PKCS7_SIGNED *sign;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* NID_pkcs7_enveloped */</span></span><br><span class="line">   PKCS7_ENVELOPE *enveloped;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* NID_pkcs7_signedAndEnveloped */</span></span><br><span class="line">   PKCS7_SIGN_ENVELOPE *signed_and_enveloped;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* NID_pkcs7_digest */</span></span><br><span class="line">   PKCS7_DIGEST *digest;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* NID_pkcs7_encrypted */</span></span><br><span class="line">   PKCS7_ENCRYPT *encrypted;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* Anything else */</span></span><br><span class="line">   ASN1_TYPE *other;</span><br><span class="line"> &#125; d;</span><br><span class="line">&#125; PKCS7;</span><br></pre></td></tr></table></figure></p>
<p>pkcs7 各种类型数据结构的 DER 编解码通过宏在 crypto/pkcs7/pk7_asn1.c 中实现</p>
<ul>
<li>可以包含6种类型的数据:<ul>
<li>id-data: 任意数据，由应用解析，可以是明文数据。</li>
<li>id-signedData: 签名数据</li>
<li>id-envelopedData: 加密数据</li>
<li>id-signedAndEnvelopedData: 签名又加密数据，数字信封</li>
<li>id-digestedData: 摘要数据，原文及摘要结果</li>
<li>id-encryptedData: 只有加密数据，密钥在带外传送、管理</li>
</ul>
</li>
</ul>
<p>数字信封流程：（A：发送方；B：接收方；SK：私钥；PK：公钥）</p>
<ul>
<li>A对<strong>明文</strong>进行hash运算，得到<strong>摘要</strong></li>
<li>A用自己的私钥<strong>A:SK</strong>对摘要进行RSA私钥加密运算，得到A的<strong>数字签名</strong></li>
<li>A随即产生一个用于特定加密算法的<strong>加密密钥</strong>（DES密钥），并使用该密钥对<strong>明文</strong>进行对称加密，形成<strong>密文</strong></li>
<li><p>A使用B的公钥<strong>B:PK</strong>对随机产生的加密密钥进行RSA公钥加密运算，并将结果与密文一同传送给B</p>
</li>
<li><p>B用自己的私钥<strong>B:SK</strong>对对称加密的结果进行RSA私钥解密运算，得到A随机产生的对称<strong>加密密钥</strong></p>
</li>
<li>B用<strong>加密密钥</strong>对密文解密，得到<strong>明文</strong></li>
<li>B用A的公钥<strong>A:PK</strong>对A的<strong>数字签名</strong>进行RSA公钥解密运算，得到A的<strong>信息摘要</strong></li>
<li>B用相同的hash算法对明文进行hash运算，得到新的信息摘要，并与收到的信息摘要比较，若一致，则说明明文未被修改，来自A。</li>
</ul>
<p>常用的用途有:</p>
<ul>
<li>证书链</li>
<li>数字信封</li>
<li>带原文的签名数据</li>
</ul>
<p><a href="http://hbaojun.github.io/2014/02/18/PKCS7%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90%E4%B9%8B%E7%AD%BE%E5%90%8D/" target="_blank" rel="noopener">PKCS#7结构分析之签名</a></p>
<p><a href="http://hbaojun.github.io/2014/02/19/PKCS7%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90%E4%B9%8B%E6%95%B0%E5%AD%97%E4%BF%A1%E5%B0%81/" target="_blank" rel="noopener">PKCS#7结构分析之数字信封</a></p>
<h2 id="附：数字信封"><a href="#附：数字信封" class="headerlink" title="附：数字信封"></a>附：数字信封</h2><p><img src="/images/envelop.png" alt="加密图解"></p>
<p>构造数字信封要能够达到以下功能：</p>
<ul>
<li>保密（对称加密，RSA公钥加密）</li>
<li>验证完整性（MAC值）</li>
<li>验证身份（签名）</li>
</ul>
<p>因此该结构应该包含：</p>
<ul>
<li>明文加密后的密文cryptodata</li>
<li>Hash函数生成的MAC值</li>
<li>RSA私钥加密的签名值signdata</li>
<li>（也应该包含证书，由CA担保身份）</li>
</ul>
<h2 id="2-6-PKCS-8"><a href="#2-6-PKCS-8" class="headerlink" title="2.6 PKCS#8"></a>2.6 PKCS#8</h2><p>私钥封装格式Private_Key Information Syntax Specification Version 1.2</p>
<p>定义了私钥信息语法和加密私钥语法。<br>私钥类型任意，对称算法可设置</p>
<h2 id="2-7-PKCS-10"><a href="#2-7-PKCS-10" class="headerlink" title="2.7 PKCS#10"></a>2.7 PKCS#10</h2><p>证书请求格式（主题，公钥，私钥签名）</p>
<p>RA注册流程：注册信息-&gt;审核通过-&gt;生成密钥-&gt;生成PKCS10请求-&gt;将信息和P10请求的公钥合并成CMP请求-&gt;发送到CA</p>
<h2 id="2-8-PKCS-11"><a href="#2-8-PKCS-11" class="headerlink" title="2.8 PKCS#11"></a>2.8 PKCS#11</h2><p>介质接口格式：</p>
<ul>
<li>硬件驱动</li>
<li>定义文件操作</li>
<li>权限管理</li>
</ul>
<p>对应于Windows的CSP，国密接口的SKF</p>
<h2 id="2-9-PKCS-12"><a href="#2-9-PKCS-12" class="headerlink" title="2.9 PKCS#12"></a>2.9 PKCS#12</h2><p>带私钥的个人证书格式，包含私钥、证书、证书链、CRL…</p>
<h2 id="2-10-X-509"><a href="#2-10-X-509" class="headerlink" title="2.10 X.509"></a>2.10 X.509</h2><p><a href="https://tools.ietf.org/html/rfc5280" target="_blank" rel="noopener">X.509证书与509黑名单规范</a></p>
<p>X.509数字证书主体如下：</p>
<ul>
<li>签名前的证书申请（签名对象的信息）</li>
<li>数字签名的算法（CA对证书签名使用的算法）</li>
<li>数字签名（用于验证证书的有效性，使用者使用CA的公钥使用同种算法对证书签名，查看和该数字签名是否相同）</li>
</ul>
<p>一个真实的X509数字证书包含：</p>
<ul>
<li>证书版本（V3）</li>
<li>证书序列号</li>
<li>签名算法（sha1RSA）</li>
<li>签名哈希算法（sha1）</li>
<li>签名</li>
<li>颁发者信息<ul>
<li>CN</li>
<li>OU</li>
<li>O组织</li>
<li>L地点</li>
<li>S州</li>
<li>C </li>
</ul>
</li>
<li>使用者信息</li>
<li>有效期</li>
<li>公钥</li>
<li>密钥用法<ul>
<li>Key Encipherment, Data Encipherment </li>
<li>Digital Signature, Non-Repudiation</li>
</ul>
</li>
<li>CRL分发点</li>
<li>指纹算法</li>
<li>指纹</li>
</ul>
<p><strong>结构</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">x509_st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    X509_CINF *cert_info;</span><br><span class="line">    X509_ALGOR *sig_alg;</span><br><span class="line">    ASN1_BIT_STRING *signature;</span><br><span class="line">    <span class="keyword">int</span> valid;</span><br><span class="line">    <span class="keyword">int</span> references; </span><br><span class="line">    <span class="keyword">char</span> *name;</span><br><span class="line">    CRYPTO_EX_DATA ex_data;</span><br><span class="line">    <span class="keyword">long</span> ex_pathlen;</span><br><span class="line">    <span class="keyword">long</span> ex_pcpathlen;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> ex_flags;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> ex_kusage;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> ex_xkusage;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> ex_nscert;</span><br><span class="line">    ASN1_OCTET_STRING *skid;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">AUTHORITY_KEYID_st</span> *<span class="title">akid</span>;</span></span><br><span class="line">    X509_POLICY_CACHE *policy_cache;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> OPENSSL_NO_SHA</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> sha1_hash[SHA_DIGEST_LENGTH];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    X509_CERT_AUX *aux; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>以上结构表示一个完整的数字证书，主要项如下：</p>
<ul>
<li>cert_info:证书主体信息；</li>
<li>sig_alg:签名算法；</li>
<li>signature:签名值，存放CA对该证书采用sig_alg算法签名的结果（验证证书持有者身份时，使用该CA公钥对该证书采用sig_alg签名算法签名得到signature1，将两个签名值比较，若相等，则表明是通过CA确认的证书持有者）；</li>
<li>valid：是否是合法证书，1 为合法，0 为未知；</li>
<li>references：引用次数，被引用一次则加一；</li>
<li>name：证书持有者信息该内容在调用 d2i_X509的过程中，通过回调函数 x509_cb(crypto/asn1/x_x509.c)调用 X509_NAME_oneline 来设置；</li>
</ul>
<p><strong>编程接口</strong><br>DER 编解码接口由宏在 crypto/asn1/x_x509.c 中实现，包括各自的new、free、i2d 和 d2i 函数：</p>
<ul>
<li>d2i_X509：解码 DER 编码的数字证书</li>
<li>PEM_read_bio_X509：从PEM格式的数字证书中得到X509数据结构</li>
</ul>
<h2 id="2-11-ASN-1"><a href="#2-11-ASN-1" class="headerlink" title="2.11 ASN.1"></a>2.11 ASN.1</h2><p>Abstract Syntax Notation One，抽象语法标识，是与平台、语言无关的数据结构定义语法</p>
<p><strong>编码格式</strong><br>BER、CER、DER、XER，可以编码成XML格式，不仅仅是常用的二进制流。<br>二进制流的TLV方式表达数据结构，如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Identifier octets Type</td>
<td style="text-align:center">Length octets Length</td>
<td style="text-align:center">Contents octets Value</td>
<td style="text-align:center">End-of-contents octets</td>
</tr>
</tbody>
</table>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Personnel</span><br><span class="line">Record     Length   Contents</span><br><span class="line"><span class="number">60</span>         <span class="number">8185</span></span><br><span class="line">                    Name     Length  Contents</span><br><span class="line">                    <span class="number">61</span>       <span class="number">10</span></span><br><span class="line">                                     VisibleString  Length  Contents</span><br><span class="line">                                     <span class="number">1</span>A             <span class="number">04</span>      <span class="string">"John"</span></span><br><span class="line">                                     VisibleString  Length  Contents</span><br><span class="line">                                     <span class="number">1</span>A             <span class="number">01</span>      <span class="string">"P"</span></span><br><span class="line">                                     VisibleString  Length  Contents</span><br><span class="line">                                     <span class="number">1</span>A             <span class="number">05</span>      <span class="string">"Smith"</span></span><br><span class="line"></span><br><span class="line">                     DateofBirth     Length  Contents</span><br><span class="line">                     A0              <span class="number">0</span>A</span><br><span class="line">                                             Date    Length  Contents</span><br><span class="line">                                             <span class="number">43</span>      <span class="number">08</span>      <span class="string">"19590717"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>BER: Basic Encoding Rules<ul>
<li>基本编码格式。</li>
<li>对相同的数据，可以有多种编码方式，比如长字节型、短字节型、不定长型等。</li>
</ul>
</li>
<li>DER: Distinguished Encoding Rules<ul>
<li>是BER的一个子集，为更严格的一个变种版本。</li>
<li>和BER相比，DER的编码格式只有固定一种。比如BER的Boolean变量编码值是可以1~255的任意值，而DER只能是1。</li>
<li><strong>DER使用在有数据签名的场合</strong>，以保证数据原文编码后可以保持一致。</li>
<li>X.509证书都是DER编码。</li>
</ul>
</li>
<li>CER: Canonical Encoding Rules<ul>
<li>CER和DER一样，都是BER的限定编码规则的子集。</li>
<li>CER和DER不同在于它是不定长编码，可以用于大数据块的封装。</li>
<li>PKCS#7数字信封可以用DER编码，也可以用CER编码。</li>
</ul>
</li>
</ul>
<ul>
<li>Privacy Enhanced Mail: 安全增强邮件，通过加密算法、证书加密邮件。<ul>
<li>更常用的概念是一种文件格式，该文件格式使用一个头、尾标识文件的内容，以方便解析。如下:</li>
<li>被加密的私钥:</li>
</ul>
</li>
</ul>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">----<span class="keyword">BEGIN</span> ENCRYPTED PRIVATE KEY-----</span></span><br><span class="line"><span class="ruby">...</span></span><br><span class="line"><span class="ruby">-----<span class="keyword">END</span> ENCRYPTED PRIVATE KEY-----</span></span><br></pre></td></tr></table></figure>
<ul>
<li>PEM格式的证书:</li>
</ul>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">----<span class="keyword">BEGIN</span> CERTIFICATE-----</span></span><br><span class="line"><span class="ruby">...</span></span><br><span class="line"><span class="ruby">-----<span class="keyword">END</span> CERTIFICATE-----</span></span><br></pre></td></tr></table></figure>
<ul>
<li>PEM格式的PKCS#10证书请求:</li>
</ul>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">----<span class="keyword">BEGIN</span> CERTIFICATE REQUEST-----</span></span><br><span class="line"><span class="ruby">...</span></span><br><span class="line"><span class="ruby">-----<span class="keyword">END</span> CERTIFICATE REQUEST-----</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>CER、DER、CRT、PEM的关系</p>
<ul>
<li>所有X.509都是DER编码，DER是指ASN.1的编码规则，.der证书文件一般是二进制文件。</li>
<li>CER可用于PKCS#7证书(p7b)的编码，但一般是指证书的文件后缀，.cer证书可以是纯BASE64文件或二进制文件。</li>
<li>PEM通常也是指文件的后缀，为内容使用BASE64编码且带头带尾的特定格式，二进制的文件不应该命名为pem。</li>
<li>CRT是微软的证书后缀名，和.CER是一回事。</li>
<li>微软的CryptAPI很强大，证书的各种格式都可以识别，比如纯BASE64编码的、标准PEM格式的、非标识PEM格式的(不是64字节换行、没有头尾等)、二进制格式的。</li>
<li>但openssl、JCE则不行，必须是标准的PEM格式和DER格式。</li>
<li>references:<ul>
<li><a href="http://www.cryptologie.net/article/260/asn1-vs-der-vs-pem-vs-x509-vs-pkcs7-vs/" target="_blank" rel="noopener">http://www.cryptologie.net/article/260/asn1-vs-der-vs-pem-vs-x509-vs-pkcs7-vs/</a></li>
<li><a href="http://myonlineusb.wordpress.com/2011/06/19/what-are-the-differences-between-pem-der-p7bpkcs7-pfxpkcs12-certificates/" target="_blank" rel="noopener">http://myonlineusb.wordpress.com/2011/06/19/what-are-the-differences-between-pem-der-p7bpkcs7-pfxpkcs12-certificates/</a></li>
</ul>
</li>
</ul>
</li>
<li><p>PFX</p>
<ul>
<li>Personal Information Exchange</li>
<li>PKCS#12是PFX的后续版本，一般情况二者为等同概念。</li>
<li>PFX或PKCS#12，是包括私钥的个人证书，通过口令保护私钥。</li>
<li>后缀名为.pfx或.p12</li>
<li>使用openssl、keytool、Portecle(KeyStore工具)都可以很方便生成PFX证书。</li>
<li>references:<ul>
<li><a href="http://en.wikipedia.org/wiki/PKCS_12" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/PKCS_12</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-12-CRL"><a href="#2-12-CRL" class="headerlink" title="2.12 CRL"></a>2.12 CRL</h2><p>证书撤销列表(Certificate Revocation List，简称 CRL)，是一种包含撤销的证书列表的签名数据结构。基本的 CRL 信息有：被撤销证书序列号、撤销时间、撤销原因、签名者以及 CRL 签名等信息。</p>
<p>被撤销证书的信息：X509_REVOKED</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">X509_revoked_st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ASN1_INTEGER *serialNumber;</span><br><span class="line">    ASN1_TIME *revocationDate;</span><br><span class="line">    STACK_OF(X509_EXTENSION) *extensions;</span><br><span class="line">    <span class="keyword">int</span> sequence;</span><br><span class="line">&#125; X509_REVOKED;</span><br></pre></td></tr></table></figure>
<ul>
<li>serialNumber：被撤销证书的序列号；</li>
<li>revocationDate：撤销时间；</li>
<li>extensions：扩展项，可选；</li>
<li>sequence：顺序号，用于排序，表示当前被撤销证书信息在 crl 中的顺序。</li>
</ul>
<p>crl信息主体：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">X509_crl_info_st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ASN1_INTEGER *version;</span><br><span class="line">    X509_ALGOR *sig_alg;</span><br><span class="line">    X509_NAME *issuer;</span><br><span class="line">    ASN1_TIME *lastUpdate;</span><br><span class="line">    ASN1_TIME *nextUpdate;</span><br><span class="line">    STACK_OF(X509_REVOKED) *revoked; </span><br><span class="line">    STACK_OF(X509_EXTENSION) *extensions;</span><br><span class="line">    ASN1_ENCODING enc;</span><br><span class="line">&#125; X509_CRL_INFO;</span><br></pre></td></tr></table></figure>
<ul>
<li>version：crl 版本；</li>
<li>sig_alg：crl 签名算法；</li>
<li>issuer：签发者信息；</li>
<li>lastUpdate：上次更新时间；</li>
<li>nextUpdate：下次更新时间；</li>
<li>revoked：被撤销证书信息；</li>
<li>extensions：扩展项，可选。</li>
</ul>
<p>完整crl数据结构：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X509_crl_st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    X509_CRL_INFO *crl;</span><br><span class="line">    X509_ALGOR *sig_alg;</span><br><span class="line">    ASN1_BIT_STRING *signature;</span><br><span class="line">    <span class="keyword">int</span> references;</span><br><span class="line">&#125; ;</span><br></pre></td></tr></table></figure>
<ul>
<li>crl：crl 信息主体；</li>
<li>sig_alg：签名算法，与 X509_CRL_INFO 中的一致；</li>
<li>signature：签名值；</li>
<li>references：引用</li>
</ul>
<h2 id="附3-LDAP"><a href="#附3-LDAP" class="headerlink" title="附3 LDAP"></a>附3 LDAP</h2><p>轻量目录访问协议(Lightweight Directory Access Protocol)，运行于TCP/IP之上。</p>
<p>目录的信息按照树型结构组织，数据结构：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">条目entry-&gt;区别名DN-&gt;属性Attribute-&gt;类型<span class="keyword">Type</span></span><br><span class="line">                                |<span class="type"></span></span><br><span class="line"><span class="type">                                -&gt;值Values</span></span><br></pre></td></tr></table></figure></p>
<h2 id="附4-OCSP"><a href="#附4-OCSP" class="headerlink" title="附4 OCSP"></a>附4 OCSP</h2><p>在线证书状态协议（Online Certificate Status Protocol)</p>
<p>数据格式：</p>
<ul>
<li>协议版本</li>
<li>服务请求</li>
<li>目标证书标识</li>
<li>可能被OCSP响应器处理的可选扩展</li>
</ul>
<p>OCSP响应端检测：</p>
<ul>
<li>信息正确格式化</li>
<li>响应器被配置提供请求服务而且</li>
<li>请求包含了响应器需要的信息，返回一个确定的回复，OCSP响应端回复的加密消息中包含证书的状态可以是’good’,’revoked’或者’unknown’</li>
<li>如果任何一个先决条件没有满足，那么OCSP响应器将产生一个错误信息，错误码可能包含以下内容：<ul>
<li>未正确格式化的请求（malformedRequest）</li>
<li>内部错误（internalError）</li>
<li>请稍后再试(trylater)</li>
<li>需要签名(sigRequired)</li>
<li>未授权(unauthorized)</li>
</ul>
</li>
</ul>
<h2 id="2-13-数字证书"><a href="#2-13-数字证书" class="headerlink" title="2.13 数字证书"></a>2.13 数字证书</h2><p><strong>发证流程：</strong></p>
<ul>
<li>申请者将合法的身份信息（参考X509章节）以PKCS#10格式通过SCEP（简单证书颁发协议，工作在HTTP之上）发送给CA，</li>
<li>CA验证申请者的合法性，满足条件就会产生一个合法的证书，内容包括身份信息、公钥、CA信息、CA签名、有效时间、序列号、CRL表的下载地址或查询地址</li>
<li>CA使用申请者公钥将X.509v3加密得到密文格式证书，使用SCEP协议颁发给申请者</li>
<li>申请者使用自己的私钥解密得到X.509v3证书并保存</li>
</ul>
<p><strong>双证书：</strong><br>双证书即双密钥（签名密钥对，加密密钥对）</p>
<ul>
<li>签名密钥对用于数据完整性检测，保证放伪造与防抵赖，若遗失，不影响以前数据的验证。因此不需要第三方管理。</li>
<li>加密密钥对用于数据的加密保护，若遗失，将导致之前加密的数据无法解密。因此加密密钥对应有可信第三方（CA）产生备份。</li>
</ul>
<p>（附：我曾今将整理的文件使用一款加密软件加密，选择加密密码的时候由于自己记不住长密码，又不想将长密码以任何形式记录下来，于是决定使用自认为固定的文件作为密钥，然后当再次使用文件解密的时候，被告知不是该文件。才想起，这个当时在我看来是固定的文件，由于版本需要被我修改了！整理的三个月的文件就这样脱胎换骨成了0110…）<br><strong>验证过程</strong></p>
<ol>
<li>拆封证书<ul>
<li>目的：获取证书中的公钥</li>
</ul>
</li>
<li>验证证书链<ul>
<li>目的：验证签发用户实体证书的CA是否是权威可信的CA</li>
<li>操作：使用每级CA的公钥验证每级数字签名</li>
</ul>
</li>
<li>验证序列号<ul>
<li>目的：检查实体证书中的签名实体序列号是否与签发者证书的序列号相一致</li>
<li>操作：用户实体证书中的Authority Key Identifier扩展项Cert Serial Number,即签发证书的序列号与CA证书中的Certificate Serial Number 证书序列号是否一致</li>
</ul>
</li>
<li>证书废止列表查询（黑名单查询，CRL）<ul>
<li>目的：检查用户证书是否作废</li>
</ul>
</li>
</ol>
<h1 id="3-OpenSSL"><a href="#3-OpenSSL" class="headerlink" title="3 OpenSSL"></a>3 OpenSSL</h1><h2 id="3-1-命令行"><a href="#3-1-命令行" class="headerlink" title="3.1 命令行"></a>3.1 命令行</h2><p><strong>构建数字证书</strong><br>主要操作包括产生私钥（key），构造证书请求（req），签发用户证书，自签发根证书。</p>
<ul>
<li>1.产生私钥（带密码保护）：<code>openssl genrsa -out mysite.key -des3 -passout pass:123456 1024</code></li>
<li>2.构造证书请求<ul>
<li>交互式输入：<code>openssl req -key mysite.key -passin pass:123456 -new -out mysite.req</code></li>
<li>非交互式输入，先编辑配置文件mysite.conf，然后生成请求：<code>openssl req -key mysite.key -passin pass:123456 -new -config mysite.conf -out mysite.req</code></li>
</ul>
</li>
<li>3.签发用户证书：<code>openssl x509 -req -in mysite.req -CA testca.pem -CAkey testca.key -out mysite.pem -passin pass:abcdef -CAcreateserial</code>-days指定证书有效期</li>
<li>当然，签发用户证书的前提是已经自签发根证书，先执行1,2步生成根证书申请，然后自签发：<code>openssl x509 -req -in testCA.req -signkey testca.key -out testca.pem -passin pass:abcdef</code></li>
</ul>
<h2 id="3-2-编程"><a href="#3-2-编程" class="headerlink" title="3.2 编程"></a>3.2 编程</h2><p>对称算法和摘要算法全局初始化：<code>OpenSSL_add_all_algorithms();</code></p>
<p>释放句柄：<code>EVP_MD_CTX_cleanup(&amp;ctx);</code></p>
<h3 id="3-2-1-加解密"><a href="#3-2-1-加解密" class="headerlink" title="3.2.1 加解密"></a>3.2.1 加解密</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_CipherInit</span><span class="params">(EVP_CIPHER_CTX *ctx, <span class="keyword">const</span> EVP_CIPHER *type, <span class="keyword">unsigned</span> <span class="keyword">char</span> *key, <span class="keyword">unsigned</span> <span class="keyword">char</span> *iv, <span class="keyword">int</span> enc)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_CipherUpdate</span><span class="params">(EVP_CIPHER_CTX *ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> *out, <span class="keyword">int</span> *outl, <span class="keyword">unsigned</span> <span class="keyword">char</span> *in, <span class="keyword">int</span> inl)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_CipherFinal</span><span class="params">(EVP_CIPHER_CTX *ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> *outm, <span class="keyword">int</span> *outl)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-摘要"><a href="#3-2-2-摘要" class="headerlink" title="3.2.2 摘要"></a>3.2.2 摘要</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_DigestInit</span><span class="params">(EVP_MD_CTX *ctx, <span class="keyword">const</span> EVP_MD *type)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_DigestUpdate</span><span class="params">(EVP_MD_CTX *ctx, <span class="keyword">const</span> <span class="keyword">void</span> *d, <span class="keyword">size_t</span> cnt)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_DigestFinal</span><span class="params">(EVP_MD_CTX *ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> *md, <span class="keyword">unsigned</span> <span class="keyword">int</span> *s)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-签名验签-RSA-ECDSA"><a href="#3-2-3-签名验签-RSA-ECDSA" class="headerlink" title="3.2.3 签名验签(RSA/ECDSA)"></a>3.2.3 签名验签(RSA/ECDSA)</h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EVP_SignInit ( <span class="name">&amp;md_sign_ctx</span>, md )</span><br><span class="line">EVP_SignUpdate(<span class="name">&amp;md_sign_ctx</span>, data, data_cb)</span><br><span class="line">EVP_SignFinal (<span class="name">&amp;md_sign_ctx</span>, sign, psign_cb, pPriKey )</span><br><span class="line"></span><br><span class="line">EVP_VerifyInit( <span class="name">&amp;md_verify_ctx</span>, md )</span><br><span class="line">EVP_VerifyUpdate(<span class="name">&amp;md_verify_ctx</span>, data, data_cb)</span><br><span class="line">EVP_VerifyFinal(<span class="name">&amp;md_verify_ctx</span>, sign, sign_cb, pPubKey)</span><br></pre></td></tr></table></figure>
<h3 id="3-2-4-公钥加密与私钥解密（RSA算法）"><a href="#3-2-4-公钥加密与私钥解密（RSA算法）" class="headerlink" title="3.2.4 公钥加密与私钥解密（RSA算法）"></a>3.2.4 公钥加密与私钥解密（RSA算法）</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EVP_PKEY_encrypt</span>	<span class="params">(	EVP_PKEY_CTX * 	ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> * 	out, <span class="keyword">size_t</span> * 	outlen, <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> * 	in, <span class="keyword">size_t</span> 	inlen )</span></span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-5-PKCS7签名验签（RSA-ECDSA）"><a href="#3-2-5-PKCS7签名验签（RSA-ECDSA）" class="headerlink" title="3.2.5 PKCS7签名验签（RSA/ECDSA）"></a>3.2.5 PKCS7签名验签（RSA/ECDSA）</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">p7</span> <span class="string">=</span> <span class="string">PKCS7_sign(x,</span> <span class="string">pPriKey,</span> <span class="literal">NULL</span><span class="string">,</span> <span class="string">in,</span> <span class="string">PKCS7_BINARY)</span></span><br><span class="line"><span class="string">PKCS7_verify(p7,</span> <span class="literal">NULL</span><span class="string">,</span> <span class="literal">NULL</span><span class="string">,</span> <span class="string">in,</span> <span class="literal">NULL</span><span class="string">,</span> <span class="string">PKCS7_BINARY|PKCS7_NOVERIFY)</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-6-PKCS7数字信封加密解密（RSA）"><a href="#3-2-6-PKCS7数字信封加密解密（RSA）" class="headerlink" title="3.2.6 PKCS7数字信封加密解密（RSA）"></a>3.2.6 PKCS7数字信封加密解密（RSA）</h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p7 = PKCS7_encrypt(<span class="name">certs</span>, in, EVP_des_cbc(), PKCS7_BINARY)</span><br><span class="line">PKCS7_decrypt(<span class="name">p7</span>, pPriKey, x, out, PKCS7_BINARY)</span><br></pre></td></tr></table></figure>
<h3 id="3-2-7解密公司的加密邮件（SMIME）"><a href="#3-2-7解密公司的加密邮件（SMIME）" class="headerlink" title="3.2.7解密公司的加密邮件（SMIME）"></a>3.2.7解密公司的加密邮件（SMIME）</h3><p>公司加密邮件为标准SMIME格式，导出后得到.eml文件<br>使用<code>PKCS7 *SMIME_read_PKCS7(BIO *bio, BIO **bcont)</code>将bio读取到的SMIME格式保存在PKCS7格式内，然后通过PKCS7_dncrypt接口解密</p>
<h3 id="3-2-8错误处理"><a href="#3-2-8错误处理" class="headerlink" title="3.2.8错误处理"></a>3.2.8错误处理</h3><p>错误处理应该尽可能多的包含各种信息，包括：</p>
<ul>
<li>错误码；</li>
<li>出错文件以及行号；</li>
<li>错误原因；</li>
<li>出错函数；</li>
<li>出错库；</li>
<li>出错模块与类别信息；</li>
<li>错误堆栈信息等。</li>
</ul>
<p>ERR_get_error获取第一个错误号</p>
<p>ERR_error_string根据错误码获取具体的错误信息，包括出错的库、出错的函数以及出错原因</p>
<p>ERR_print_errors_fp将错误打印到FILE中</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://renzheng0403.github.io/2017/07/02/《白夜行》读后感——夜行者/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="renzheng">
      <meta itemprop="description" content="what's past is prologue">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="renz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/02/《白夜行》读后感——夜行者/" itemprop="url">
                  夜行者
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-07-02 05:04:00" itemprop="dateCreated datePublished" datetime="2017-07-02T05:04:00+08:00">2017-07-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-19 09:59:30" itemprop="dateModified" datetime="2018-05-19T09:59:30+08:00">2018-05-19</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后感/" itemprop="url" rel="index"><span itemprop="name">后感</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>大概是用了连着的12多个小时读完，中间只睡了4个小时。这是一本读了就让我放不下的书。这本书在我这放了有一年多了，同学和我换书看，但是一直忙于各种事，文学类的书少见的没有顾及，因此一直保持封皮未拆封的状态。这次决定看也是另一个老朋友突然提到，才想起自己手头刚好有一本。</p>
<p>我们身边总会存在这样一些人，他们身上有一种高尚的气息，未加掩饰的纯洁。提起这个人，别人会觉得，哦，他啊，不是那种做这种龌龊事的人，而提起另外一个人，仿佛他脸上写着阴谋。对第一种人心之所向无可厚非，对第二种人呲之以鼻也是人之常情，我并不想为来自社会底层的陋习做任何正名的事，我自己也厌恶那些，但读完《白夜行》，很难不去想为什么有些人总是走在灰色边缘，原因很简单啊——我的世界里根本没有太阳。</p>
<hr>
<p>什么样的人生叫没有太阳？川岛江利子是女主唐泽雪穗的中学和大学好友，尽管她在大学发生了那种事，但是究其本身的生长环境来说，她不是夜行者，所以可以看到她身上有人最崇高的品质。我没有细查作者在前期是怎样描绘江利子，总之是个其貌不扬呆在唐泽雪穗身边乖乖女。开篇介绍她的良好习惯——就寝前写日记，上学前为院子里的树浇水，星期日早上打扫房间。关于日记是这样描写的：</p>
<blockquote>
<p>不需要写什么戏剧性的大事，平铺直叙也无妨，即便是一句“今天一如往常”亦无不可。</p>
</blockquote>
<p>她憧憬能够与雪穗交朋友，在和她在一起之后更是觉得自己也对许多事物有了新的认识。文章也说了由于男生的目光都集中在雪穗身上，她难免也会有些嫉妒，但是这种嫉妒也仅限于一种未控制生物本能，在之后甚至连这种生物本能都完全消失。简而言之，江利子身上有一种称之为贵族气息的优雅，不争不抢，仿佛岁月静好。她的这个优点被来自上层社会的具有敏锐观察力的筱冢一成一眼识别。</p>
<p>灰姑娘的故事不是吗？假如不是发生后面的事，她会是第二个灰姑娘。习惯、容貌、礼仪等都是可以学习的技巧，但是那份宠辱不惊的心态是雪穗无论如何都学不来的。毕竟人，生来不平等。</p>
<hr>
<p>与之相对，唐泽雪穗的人生则是没有太阳的人生。人类从幼年到成年用时惊人，在这段漫长的岁月里，我们几乎没有任何自卫的能力，完全庇护在看护人的保护下，然而雪穗的看护人——其母西本文代，却因为种种原因，将这个残酷的世界暴露在一个小女孩的面前。年幼的西本雪穗面对的不仅仅是一个或者一次，她面对的是桐原洋介、寺崎忠夫等在未解决好个人人性而暴露出来的原罪——欲。</p>
<p>这样的一个人，在以后的岁月里，你指望她也能闲看花开花落，云起云涌吗？她只会尽全力将自己武装起来，任何人对她来说都将是工具，因为她无法信任任何人。毕竟在她年幼的时候，自己的母亲都不值得信任。</p>
<p>在她被唐泽礼子收养之后，她是否曾放下自己的心房呢？你尽可以猜测，由于唐泽礼子家娴静的环境，不愁吃穿不惧生活，她也会获得真正的快乐吧，从而放下罪恶。加入你真有这种想法，哪怕一刻钟，就表明你更偏向于川岛江利子式而不是唐泽雪穗式的思考方式。进入唐泽礼子家是雪穗内心权衡的对自己最有利的选择。年幼的她在生母还在世的时候，有两个地方会带给她内心的一些依靠，一个是图书馆，另一个就是唐泽礼子家，这两个地方带给她的均是逃，逃避了现世的残酷。在图书馆里，阅读带人沉浸在书所描绘的世界，而与远房亲戚唐泽礼子的交流则让她体会到了一个完全不同于自己生母所提供的生活环境，那里谈吐优雅洁净，心之所向大概就是这种感觉。</p>
<p>在发现自己的母亲自杀后，她冷静的分析现状，并布置了意外死亡的假象，又借由无法找到钥匙的理由，耽误了救治的最佳时间。结果最终如她所愿，如愿以偿的被收养。从此以后，她的行事准则只看是否对自己有利，而不会再去关心爱护身边的人。加入你能感受到她对你的关心，对她来说却仅仅是方程式一般的必做事项，无所谓感情。</p>
<blockquote>
<p>我的天空里没有太阳，总是黑夜，但并不暗，因为有东西代替了太阳。虽然没有太阳那么明亮，但对我来说已经足够。凭借着这份光，我便能把黑夜当成白天。我从来就没有太阳，所以不怕失去。</p>
</blockquote>
<p>这段话算是雪穗的自白了吧。代替了太阳的应该就是桐原亮司，桐原亮司是她的图书馆小伙伴，最重要的是，在她最绝望的时候，他为她黑暗的人生点亮了一盏灯，将她从越陷越深的泥淖里解救了出来。“并不暗，有东西代替了太阳。”光是说出这句话，内心的幸福感恐怕都要爆棚。</p>
<p>我们可以说川岛江利子天生幸运，又是不幸的；而唐泽雪穗是天生不幸，又是幸运的。在于人生路上的光，雪穗遇到了伴随她行走的光，因此即使是在黑夜，她都有走下去的勇气。雪穗的另一句话：</p>
<blockquote>
<p>有些人一辈子都活在太阳的照耀下，也有些人不得不一直活在漆黑的深夜里。人害怕的是本来一直存在的太阳落下不再升起，也就是非常害怕原来照在身上的光芒突然消失。</p>
</blockquote>
<p>全文的最后，桐原亮司死之后是这样描述雪穗的：</p>
<blockquote>
<p>只见雪穗正沿扶梯上楼，她的背影犹如白色的影子。<br>她一次都没有回头。</p>
</blockquote>
<p>这段描述突然让我想起了小时候看的一个镜头：<br><img src="http://upload-images.jianshu.io/upload_images/5278708-b0cb5df6a8b6cd9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="天下无贼.png"></p>
<p>雪穗已经死了，因为照在她身上的光已经消失。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">renzheng</p>
              <p class="site-description motion-element" itemprop="description">what's past is prologue</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">renzheng</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Mist</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
